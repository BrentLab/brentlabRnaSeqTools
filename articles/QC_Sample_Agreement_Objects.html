<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="brentlabRnaSeqTools">
<title>QC: Replicate Agreement Object Creation • brentlabRnaSeqTools</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="QC: Replicate Agreement Object Creation">
<meta property="og:description" content="brentlabRnaSeqTools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">brentlabRnaSeqTools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/QC_Library_Quality.html">QC: Library Quality</a>
    <a class="dropdown-item" href="../articles/QC_Sample_Agreement_Analysis_Tally.html">QC: Replicate Agreement Analysis and tally</a>
    <a class="dropdown-item" href="../articles/QC_Sample_Agreement_Objects.html">QC: Replicate Agreement Object Creation</a>
    <a class="dropdown-item" href="../articles/Replicate_Tallies.html">Replicate_Tallies</a>
    <a class="dropdown-item" href="../articles/UsingRstudioProjects.html">UsingRstudioProjects</a>
    <a class="dropdown-item" href="../articles/envPerturbation.html">Environmental Perturbation Analysis Data Creation</a>
    <a class="dropdown-item" href="../articles/ninetyMinInduction_tally.html">90 Minute Induction Tally</a>
    <a class="dropdown-item" href="../articles/ninetyMinuteInduction_analysis.html">90 Minute Induction Analysis Data Creation</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="QC_Sample_Agreement_Objects_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>QC: Replicate Agreement Object Creation</h1>
                        <h4 data-toc-skip class="author">Chase Mateusiak</h4>
            
            <h4 data-toc-skip class="date">01/29/2022</h4>
      
      
      <div class="d-none name"><code>QC_Sample_Agreement_Objects.Rmd</code></div>
    </div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      <p>Tally the 90minuteInduction experiment set. brentlabRnaSeqTools package version: 0.0.0.0</p>
    </div>
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This illustrates how to construct the data object for the Sample Agreement QC step – RLE – on each of the data sets. In each case, once you have added the design (the last step for each set), you need to write the object to file and send it to the cluster. I suggest mounting to the cluster and writing to the mounted directory. See the vignette <em>Running DESeq on HTCF</em> for instructions on running DESeq on HTCF.</p>
<p>You can see all defined sets by entering <code><a href="../reference/createExperimentSet.html">?createExperimentSet</a></code>. If an experiment set you are interested in does not exist as an option in <code>set_names</code>, then you’ll need to use the <code>extractColData(blrs)</code> of the <code>blrs</code> object below to play around and come up with a set of filters to define your new set. See the github repository, “R/ExperimentSetFunctions.R” for examples</p>
<div class="section level3">
<h3 id="setup-the-environment">Setup the environment<a class="anchor" aria-label="anchor" href="#setup-the-environment"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">brentlabRnaSeqTools</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">rtracklayer</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/" class="external-link">caret</a></span><span class="op">)</span>

<span class="co"># set variables </span>

<span class="va">KN99_GFF_PATH</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"kn99_gff"</span><span class="op">)</span>
<span class="va">DB_USERNAME</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"db_username"</span><span class="op">)</span>
<span class="va">DB_PASSWORD</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"db_password"</span><span class="op">)</span>

<span class="co"># note: I mount to the cluster and output directly to it</span>
<span class="va">DDS_OUTPUT_DIR</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"OUTPUT_DIR"</span><span class="op">)</span>
<span class="va">TODAY</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html" class="external-link">today</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">"%Y%m%d"</span><span class="op">)</span>

<span class="co"># controls whether dds objects are written</span>
<span class="va">WRITE_OUT</span> <span class="op">=</span> <span class="cn">TRUE</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="pull-the-database">Pull the database<a class="anchor" aria-label="anchor" href="#pull-the-database"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">blrs</span> <span class="op">=</span> <span class="fu"><a href="../reference/brentlabRnaSeqSet.html">brentlabRnaSeqSetFromDatabase</a></span><span class="op">(</span><span class="st">'kn99'</span>,<span class="va">DB_USERNAME</span>, <span class="va">DB_PASSWORD</span><span class="op">)</span>

<span class="co"># filter down to just the protein coding genes. Note that this works because the</span>
<span class="co"># nctr-rna annotations were all added to the end of the annotation file.</span>
<span class="va">blrs</span> <span class="op">=</span> <span class="va">blrs</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6967</span>,<span class="op">]</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="add-gene-level-data-optional">Add gene level data (optional)<a class="anchor" aria-label="anchor" href="#add-gene-level-data-optional"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># this adds all of the data regarding each locus as a GRange object to the</span>
<span class="co"># gene data slot of the brentlabRnaSeqSet object. Useful if you are going to</span>
<span class="co"># use other Bioconductor packages, or brentlabRnaSeqTools::createIgvBrowserShot()</span>

<span class="va">kn99_gff</span> <span class="op">=</span> <span class="fu">rtracklayer</span><span class="fu">::</span><span class="fu">import</span><span class="op">(</span><span class="va">KN99_GFF_PATH</span><span class="op">)</span>

<span class="va">kn99_genes</span> <span class="op">=</span> <span class="va">kn99_gff</span><span class="op">[</span><span class="va">kn99_gff</span><span class="op">$</span><span class="va">ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">blrs</span><span class="op">)</span><span class="op">]</span>

<span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/RangedSummarizedExperiment-class.html" class="external-link">rowRanges</a></span><span class="op">(</span><span class="va">blrs</span><span class="op">)</span> <span class="op">=</span> <span class="va">kn99_genes</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">kn99_genes</span><span class="op">$</span><span class="va">ID</span>,<span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">blrs</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="minuteinduction">90minuteInduction<a class="anchor" aria-label="anchor" href="#minuteinduction"></a>
</h2>
<div class="section level3">
<h3 id="grant-set">2016 grant set<a class="anchor" aria-label="anchor" href="#grant-set"></a>
</h3>
<p>This is the data set defined by the single locus KOs in 90minuteInduction conditions for genotypes in the <code>grant_df</code> (this is a data object which is loaded as part of <code>brentlabRnaSeqTools</code> – take a look if you are interested)</p>
<div class="section level4">
<h4 id="create-the-set-and-quality-filter">Create the set and quality filter<a class="anchor" aria-label="anchor" href="#create-the-set-and-quality-filter"></a>
</h4>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">blrs_90min_grant</span> <span class="op">=</span> <span class="fu"><a href="../reference/createExperimentSet.html">createExperimentSet</a></span><span class="op">(</span><span class="va">blrs</span>, <span class="st">'ninetyMin_2016Grant'</span><span class="op">)</span>

<span class="co"># note that this filters out those samples which failed QC1, </span>
<span class="co"># but but does not filter on RLE unless the argument rle_iqr_threshold </span>
<span class="co"># is set to a numeric value</span>
<span class="va">blrs_90min_grant_fltr</span> <span class="op">=</span> <span class="fu"><a href="../reference/qaFilter.html">qaFilter</a></span><span class="op">(</span><span class="va">blrs_90min_grant</span><span class="op">)</span>

<span class="co"># remove WT which fall on dates with no perturbed samples</span>
<span class="va">blrs_90min_grant_fltr</span> <span class="op">=</span> 
  <span class="fu"><a href="../reference/filterWtByExperimentalLibdate_90min.html">filterWtByExperimentalLibdate_90min</a></span><span class="op">(</span><span class="va">blrs_90min_grant_fltr</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="add-the-design">Add the design<a class="anchor" aria-label="anchor" href="#add-the-design"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">blrs_90min_grant_fltr</span> <span class="op">=</span> <span class="fu"><a href="../reference/estimateSizeFactorsByProtocol.html">estimateSizeFactorsByProtocol</a></span><span class="op">(</span><span class="va">blrs_90min_grant_fltr</span><span class="op">)</span>

<span class="va">min_libdate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">blrs_90min_grant_fltr</span><span class="op">)</span><span class="op">$</span><span class="va">libraryDate</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">blrs_90min_grant_fltr</span><span class="op">)</span><span class="op">$</span><span class="va">libraryDate</span> <span class="op">=</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">blrs_90min_grant_fltr</span><span class="op">)</span><span class="op">$</span><span class="va">libraryDate</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html" class="external-link">relevel</a></span><span class="op">(</span>ref <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">min_libdate</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">blrs_90min_grant_fltr</span><span class="op">)</span><span class="op">$</span><span class="va">libraryProtocol</span> <span class="op">=</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">blrs_90min_grant_fltr</span><span class="op">)</span><span class="op">$</span><span class="va">libraryProtocol</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html" class="external-link">relevel</a></span><span class="op">(</span>ref <span class="op">=</span> <span class="st">"SolexaPrep"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">blrs_90min_grant_fltr</span><span class="op">)</span><span class="op">$</span><span class="va">genotype1</span> <span class="op">=</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">blrs_90min_grant_fltr</span><span class="op">)</span><span class="op">$</span><span class="va">genotype1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html" class="external-link">relevel</a></span><span class="op">(</span>ref <span class="op">=</span> <span class="st">"CNAG_00000"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">mm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="va">libraryProtocol</span><span class="op">+</span><span class="va">libraryDate</span><span class="op">+</span><span class="va">genotype1</span>, 
                  <span class="fu"><a href="../reference/extractColData.html">extractColData</a></span><span class="op">(</span><span class="va">blrs_90min_grant_fltr</span><span class="op">)</span><span class="op">)</span>

<span class="va">min_new_protocol</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span>
  <span class="fu"><a href="../reference/extractColData.html">extractColData</a></span><span class="op">(</span><span class="va">blrs_90min_grant_fltr</span><span class="op">)</span>, 
  <span class="va">libraryProtocol</span> <span class="op">==</span> <span class="st">'E7420L'</span><span class="op">)</span>, 
  <span class="va">libraryDate</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">mm</span> <span class="op">=</span> <span class="va">mm</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mm</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'libraryDate'</span>,<span class="va">min_new_protocol</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<div class="section level5">
<h5 id="inspect-the-model-matrix-for-linear-dependencies">inspect the model matrix for linear dependencies<a class="anchor" aria-label="anchor" href="#inspect-the-model-matrix-for-linear-dependencies"></a>
</h5>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lin_dep_report</span> <span class="op">=</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu">findLinearCombos</span><span class="op">(</span><span class="va">mm</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level5">
<h5 id="add-the-design-to-the-object">add the design to the object<a class="anchor" aria-label="anchor" href="#add-the-design-to-the-object"></a>
</h5>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">design</span><span class="op">(</span><span class="va">blrs_90min_grant_fltr</span><span class="op">)</span> <span class="op">=</span> <span class="va">mm</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">mm</span><span class="op">)</span>

<span class="kw">if</span><span class="op">(</span><span class="va">WRITE_OUT</span><span class="op">)</span><span class="op">{</span>
  
  <span class="va">outpath</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DDS_OUTPUT_DIR</span>,
                      <span class="st">"90minDataFreeze"</span>,
                      <span class="va">TODAY</span>,
                      <span class="st">"grant_only_input.rds"</span><span class="op">)</span>
  
  <span class="va">dds</span> <span class="op">=</span> <span class="fu">DESeq2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/DESeqDataSet.html" class="external-link">DESeqDataSetFromMatrix</a></span><span class="op">(</span>
    colData <span class="op">=</span> <span class="fu"><a href="../reference/extractColData.html">extractColData</a></span><span class="op">(</span><span class="va">blrs_90min_grant_fltr</span><span class="op">)</span>,
    countData <span class="op">=</span> <span class="fu">counts</span><span class="op">(</span><span class="va">blrs_90min_grant_fltr</span><span class="op">)</span>,
    design <span class="op">=</span> <span class="fu">design</span><span class="op">(</span><span class="va">blrs_90min_grant_fltr</span><span class="op">)</span><span class="op">)</span>
  
  <span class="fu">sizeFactors</span><span class="op">(</span><span class="va">dds</span><span class="op">)</span> <span class="op">=</span> <span class="fu">sizeFactors</span><span class="op">(</span><span class="va">blrs_90min_grant_fltr</span><span class="op">)</span>
  
  <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span><span class="va">dds</span>, <span class="va">outpath</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="grant-set-with-doubles">2016 Grant Set with Doubles<a class="anchor" aria-label="anchor" href="#grant-set-with-doubles"></a>
</h3>
<p>This has all double KO samples in which either of the KO loci are in the <code>grant_df</code>, plus single KO samples corresponding to one of the double KO perturbed loci and WT.</p>
<div class="section level4">
<h4 id="create-set-and-quality-filter">Create set and quality filter<a class="anchor" aria-label="anchor" href="#create-set-and-quality-filter"></a>
</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">blrs_grant_with_doubles</span> <span class="op">=</span> <span class="fu"><a href="../reference/createExperimentSet.html">createExperimentSet</a></span><span class="op">(</span><span class="va">blrs</span>, <span class="st">'ninetyMin_2016GrantWithDoubles'</span><span class="op">)</span>

<span class="co"># note that this filters out those samples which failed QC1, </span>
<span class="co"># but but does not filter on RLE unless the argument rle_iqr_threshold </span>
<span class="co"># is set to a numeric value</span>
<span class="va">blrs_grant_with_doubles_fltr</span> <span class="op">=</span> <span class="fu"><a href="../reference/qaFilter.html">qaFilter</a></span><span class="op">(</span><span class="va">blrs_grant_with_doubles</span><span class="op">)</span>

<span class="co"># remove WT which fall on dates with no perturbed samples</span>
<span class="va">blrs_grant_with_doubles_fltr</span> <span class="op">=</span> 
  <span class="fu"><a href="../reference/filterWtByExperimentalLibdate_90min.html">filterWtByExperimentalLibdate_90min</a></span><span class="op">(</span><span class="va">blrs_grant_with_doubles_fltr</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="add-the-design-1">Add the design<a class="anchor" aria-label="anchor" href="#add-the-design-1"></a>
</h4>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">blrs_grant_with_doubles_fltr</span> <span class="op">=</span> <span class="fu"><a href="../reference/estimateSizeFactorsByProtocol.html">estimateSizeFactorsByProtocol</a></span><span class="op">(</span><span class="va">blrs_grant_with_doubles_fltr</span><span class="op">)</span>

<span class="va">min_libdate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">blrs_grant_with_doubles_fltr</span><span class="op">)</span><span class="op">$</span><span class="va">libraryDate</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">blrs_grant_with_doubles_fltr</span><span class="op">)</span><span class="op">$</span><span class="va">libraryDate</span> <span class="op">=</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">blrs_grant_with_doubles_fltr</span><span class="op">)</span><span class="op">$</span><span class="va">libraryDate</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html" class="external-link">relevel</a></span><span class="op">(</span>ref <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">min_libdate</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># add a 'genotype' column which is a concatenation of genotype1 and genotype2</span>
<span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">blrs_grant_with_doubles_fltr</span><span class="op">)</span><span class="op">$</span><span class="va">genotype</span> <span class="op">=</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">blrs_grant_with_doubles_fltr</span><span class="op">)</span><span class="op">$</span><span class="va">genotype1</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">blrs_grant_with_doubles_fltr</span><span class="op">)</span><span class="op">$</span><span class="va">genotype2</span>,
        sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="st">'_$'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html" class="external-link">relevel</a></span><span class="op">(</span>ref <span class="op">=</span> <span class="st">"CNAG_00000"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">blrs_grant_with_doubles_fltr</span><span class="op">)</span><span class="op">$</span><span class="va">libraryProtocol</span> <span class="op">=</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">blrs_grant_with_doubles_fltr</span><span class="op">)</span><span class="op">$</span><span class="va">libraryProtocol</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html" class="external-link">relevel</a></span><span class="op">(</span>ref <span class="op">=</span> <span class="st">"SolexaPrep"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">mm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="va">libraryProtocol</span><span class="op">+</span><span class="va">libraryDate</span><span class="op">+</span><span class="va">genotype</span>, 
                  <span class="fu"><a href="../reference/extractColData.html">extractColData</a></span><span class="op">(</span><span class="va">blrs_grant_with_doubles_fltr</span><span class="op">)</span><span class="op">)</span>

<span class="va">min_new_protocol</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span>
    <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="../reference/extractColData.html">extractColData</a></span><span class="op">(</span><span class="va">blrs_grant_with_doubles_fltr</span><span class="op">)</span>, 
               <span class="va">libraryProtocol</span> <span class="op">==</span> <span class="st">'E7420L'</span><span class="op">)</span>, <span class="va">libraryDate</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">mm</span> <span class="op">=</span> <span class="va">mm</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mm</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'libraryDate'</span>,<span class="va">min_new_protocol</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<div class="section level5">
<h5 id="inspect-the-model-matrix-for-linear-dependencies-1">inspect the model matrix for linear dependencies<a class="anchor" aria-label="anchor" href="#inspect-the-model-matrix-for-linear-dependencies-1"></a>
</h5>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lin_dep_report</span> <span class="op">=</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu">findLinearCombos</span><span class="op">(</span><span class="va">mm</span><span class="op">)</span>
<span class="va">lin_dep_report</span></code></pre></div>
</div>
<div class="section level5">
<h5 id="add-the-design-to-the-object-1">add the design to the object<a class="anchor" aria-label="anchor" href="#add-the-design-to-the-object-1"></a>
</h5>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">design</span><span class="op">(</span><span class="va">blrs_grant_with_doubles_fltr</span><span class="op">)</span> <span class="op">=</span> <span class="va">mm</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">mm</span><span class="op">)</span>

<span class="kw">if</span><span class="op">(</span><span class="va">WRITE_OUT</span><span class="op">)</span><span class="op">{</span>
  
  <span class="va">outpath</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DDS_OUTPUT_DIR</span>,
                      <span class="st">"90minDataFreeze"</span>,
                      <span class="va">TODAY</span>,
                      <span class="st">"grant_doubles_input.rds"</span><span class="op">)</span>
  
  <span class="va">dds</span> <span class="op">=</span> <span class="fu">DESeq2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/DESeqDataSet.html" class="external-link">DESeqDataSetFromMatrix</a></span><span class="op">(</span>
    colData <span class="op">=</span> <span class="fu"><a href="../reference/extractColData.html">extractColData</a></span><span class="op">(</span><span class="va">blrs_grant_with_doubles_fltr</span><span class="op">)</span>,
    countData <span class="op">=</span> <span class="fu">counts</span><span class="op">(</span><span class="va">blrs_grant_with_doubles_fltr</span><span class="op">)</span>,
    design <span class="op">=</span> <span class="fu">design</span><span class="op">(</span><span class="va">blrs_grant_with_doubles_fltr</span><span class="op">)</span><span class="op">)</span>
  
  <span class="fu">sizeFactors</span><span class="op">(</span><span class="va">dds</span><span class="op">)</span> <span class="op">=</span> <span class="fu">sizeFactors</span><span class="op">(</span><span class="va">blrs_grant_with_doubles_fltr</span><span class="op">)</span>
  
  <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span><span class="va">dds</span>, <span class="va">outpath</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="all">All<a class="anchor" aria-label="anchor" href="#all"></a>
</h3>
<p>This set is all samples – singles and doubles – which are in the 90minuteInduction conditions.</p>
<div class="section level4">
<h4 id="create-set-and-quality-filter-1">Create set and quality filter<a class="anchor" aria-label="anchor" href="#create-set-and-quality-filter-1"></a>
</h4>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">blrs_90min_all</span> <span class="op">=</span> <span class="fu"><a href="../reference/createExperimentSet.html">createExperimentSet</a></span><span class="op">(</span><span class="va">blrs</span>, <span class="st">'ninetyMin_all'</span><span class="op">)</span>

<span class="co"># note that this filters out those samples which failed QC1, </span>
<span class="co"># but but does not filter on RLE unless the argument rle_iqr_threshold </span>
<span class="co"># is set to a numeric value</span>
<span class="va">blrs_90min_all_fltr</span> <span class="op">=</span> <span class="fu"><a href="../reference/qaFilter.html">qaFilter</a></span><span class="op">(</span><span class="va">blrs_90min_all</span><span class="op">)</span>

<span class="co"># remove WT which fall on dates with no perturbed samples</span>
<span class="va">blrs_90min_all_fltr</span> <span class="op">=</span> 
  <span class="fu"><a href="../reference/filterWtByExperimentalLibdate_90min.html">filterWtByExperimentalLibdate_90min</a></span><span class="op">(</span><span class="va">blrs_90min_all_fltr</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="add-the-design-2">Add the design<a class="anchor" aria-label="anchor" href="#add-the-design-2"></a>
</h4>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">blrs_90min_all_fltr</span> <span class="op">=</span> <span class="fu"><a href="../reference/estimateSizeFactorsByProtocol.html">estimateSizeFactorsByProtocol</a></span><span class="op">(</span><span class="va">blrs_90min_all_fltr</span><span class="op">)</span>

<span class="va">min_libdate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">blrs_90min_all_fltr</span><span class="op">)</span><span class="op">$</span><span class="va">libraryDate</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">blrs_90min_all_fltr</span><span class="op">)</span><span class="op">$</span><span class="va">libraryDate</span> <span class="op">=</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">blrs_90min_all_fltr</span><span class="op">)</span><span class="op">$</span><span class="va">libraryDate</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html" class="external-link">relevel</a></span><span class="op">(</span>ref <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">min_libdate</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># add a 'genotype' column which is a concatenation of genotype1 and genotype2</span>
<span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">blrs_90min_all_fltr</span><span class="op">)</span><span class="op">$</span><span class="va">genotype</span> <span class="op">=</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">blrs_90min_all_fltr</span><span class="op">)</span><span class="op">$</span><span class="va">genotype1</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">blrs_90min_all_fltr</span><span class="op">)</span><span class="op">$</span><span class="va">genotype2</span>,
        sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="st">'_$'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html" class="external-link">relevel</a></span><span class="op">(</span>ref <span class="op">=</span> <span class="st">"CNAG_00000"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">blrs_90min_all_fltr</span><span class="op">)</span><span class="op">$</span><span class="va">libraryProtocol</span> <span class="op">=</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">blrs_90min_all_fltr</span><span class="op">)</span><span class="op">$</span><span class="va">libraryProtocol</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html" class="external-link">relevel</a></span><span class="op">(</span>ref <span class="op">=</span> <span class="st">"SolexaPrep"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">mm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="va">libraryProtocol</span><span class="op">+</span><span class="va">libraryDate</span><span class="op">+</span><span class="va">genotype</span>, 
                  <span class="fu"><a href="../reference/extractColData.html">extractColData</a></span><span class="op">(</span><span class="va">blrs_90min_all_fltr</span><span class="op">)</span><span class="op">)</span>

<span class="va">min_new_protocol</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span>
    <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="../reference/extractColData.html">extractColData</a></span><span class="op">(</span><span class="va">blrs_90min_all_fltr</span><span class="op">)</span>, 
               <span class="va">libraryProtocol</span> <span class="op">==</span> <span class="st">'E7420L'</span><span class="op">)</span>, <span class="va">libraryDate</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">mm</span> <span class="op">=</span> <span class="va">mm</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mm</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'libraryDate'</span>,<span class="va">min_new_protocol</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<div class="section level5">
<h5 id="inspect-the-model-matrix-for-linear-dependencies-2">inspect the model matrix for linear dependencies<a class="anchor" aria-label="anchor" href="#inspect-the-model-matrix-for-linear-dependencies-2"></a>
</h5>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lin_dep_report</span> <span class="op">=</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu">findLinearCombos</span><span class="op">(</span><span class="va">mm</span><span class="op">)</span>
<span class="va">lin_dep_report</span></code></pre></div>
</div>
<div class="section level5">
<h5 id="add-the-design-to-the-object-2">add the design to the object<a class="anchor" aria-label="anchor" href="#add-the-design-to-the-object-2"></a>
</h5>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">design</span><span class="op">(</span><span class="va">blrs_90min_all_fltr</span><span class="op">)</span> <span class="op">=</span> <span class="va">mm</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">mm</span><span class="op">)</span>

<span class="kw">if</span><span class="op">(</span><span class="va">WRITE_OUT</span><span class="op">)</span><span class="op">{</span>
  
  <span class="va">outpath</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">DDS_OUTPUT_DIR</span>,
                      <span class="st">"90minDataFreeze"</span>,
                      <span class="va">TODAY</span>,
                      <span class="st">"90min_all_input.rds"</span><span class="op">)</span>
  
  <span class="va">dds</span> <span class="op">=</span> <span class="fu">DESeq2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/DESeqDataSet.html" class="external-link">DESeqDataSetFromMatrix</a></span><span class="op">(</span>
    colData <span class="op">=</span> <span class="fu"><a href="../reference/extractColData.html">extractColData</a></span><span class="op">(</span><span class="va">blrs_90min_all_fltr</span><span class="op">)</span>,
    countData <span class="op">=</span> <span class="fu">counts</span><span class="op">(</span><span class="va">blrs_90min_all_fltr</span><span class="op">)</span>,
    design <span class="op">=</span> <span class="fu">design</span><span class="op">(</span><span class="va">blrs_90min_all_fltr</span><span class="op">)</span><span class="op">)</span>
  
  <span class="fu">sizeFactors</span><span class="op">(</span><span class="va">dds</span><span class="op">)</span> <span class="op">=</span> <span class="fu">sizeFactors</span><span class="op">(</span><span class="va">blrs_90min_all_fltr</span><span class="op">)</span>
  
  <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span><span class="va">dds</span>, <span class="va">outpath</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Chase Mateusiak.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
